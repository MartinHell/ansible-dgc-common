#!/usr/bin/env python

import psycopg2
import sys

try:
    conn = psycopg2.connect("dbname='{{ zabbix_server_dbname }}' user='{{ zabbix_server_grafanauser }}' host='localhost' port='6432' password='{{ zabbix_server_grafanapassword }}' connect_timeout=1")
except:
    sys.stdout.write("Unable to connect to the database\n")
    sys.exit(2)

cur = conn.cursor()

cur.execute("""SELECT pg_is_in_recovery()""")

rows = cur.fetchall()

if "False" in repr(rows[0]):
    if sys.argv[1] == 'master':
        sys.stdout.write("Active\n")
        sys.exit(0)
    sys.stdout.write("Active\n")
    sys.exit(2)

if len(rows) > 0:
    if sys.argv[1] ==  'slave':
        sys.stdout.write("Standby\n")
        sys.exit(0)
    sys.stdout.write("Standby\n")
    sys.exit(2)
